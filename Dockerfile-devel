FROM python:2-alpine

RUN apk add --no-cache gcc musl-dev g++

ENV PYTHONUNBUFFERED 1

RUN mkdir -p /opt/flat
WORKDIR /opt/flat
ADD requirements.txt /opt/flat

# SQLite used instead
RUN sed -i '/psycopg2/d' requirements.txt

RUN pip install -r requirements.txt

VOLUME /opt/flat

ADD app /opt/flat/app
WORKDIR /opt/flat/app

RUN python manage.py migrate

EXPOSE 8000
CMD python manage.py runserver 0.0.0.0:8000
